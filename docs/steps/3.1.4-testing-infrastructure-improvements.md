# Phase 3.1.4: Testing Infrastructure Improvements

## Overview

This step focuses on modernizing the testing infrastructure for the template-related components implemented in previous steps. Current tests for TemplateSelector, TemplateForm, and TemplateBrowser components are encountering issues with TypeScript compatibility and proper mocking of the React testing environment. This step will address these issues and ensure that all template-related components have thorough test coverage.

## Dependencies

- React and Ink (for terminal UI)
- Steps 3.1.1 (Conventional Commits), 3.1.2 (Custom Template Definition), and 3.1.3 (Template Selection UI) must be completed

## Prerequisites

- Phase 1 and 2 must be complete
- Step 3.1.3 (Template Selection UI) should be completed

## Issues to Address

1. Component Type Safety
   - Fix TypeScript errors in test files for template components
   - Ensure proper typing of component props and parameters
   - Address issues with `act` from testing libraries

2. Test Mocking Strategy
   - Improve mocks for Ink components in tests
   - Create consistent mocking approach for SelectInput and TextInput
   - Fix issues with useInput hook mocking

3. Testing Class Components
   - Update testing strategy for class components (e.g., TemplateSelectItem)
   - Ensure proper rendering and event handling in tests

4. Test Coverage
   - Expand test coverage for template components
   - Add tests for error handling and edge cases
   - Ensure all UI interactions are properly tested

## Tasks

### 1. Fix Type Safety Issues in Tests

- [ ] Fix TemplateSelector.test.tsx type issues
  - Update component mocks to match expected types
  - Fix issues with act() and async testing
  - Ensure correct typing of event handlers

- [ ] Fix TemplateForm.test.tsx type issues
  - Address issues with `window.__useInputCallback`
  - Fix syntax errors and type warnings
  - Update SelectInput mocking to handle class components

- [ ] Fix TemplateBrowser.test.tsx type issues
  - Address issues with act() and async testing
  - Fix renderer variable usage
  - Ensure proper mocking of templateManager

### 2. Improve Test Mocking Infrastructure

- [ ] Create improved mocks for ink-testing-library
  - Add proper act() implementation
  - Ensure mocks match expected component signatures
  - Fix rendering issues for nested components

- [ ] Update ink component mocks
  - Ensure proper event handling in mocks
  - Fix issues with class components vs function components
  - Add support for keyboard navigation testing

### 3. Enhance Test Coverage

- [ ] Add tests for keyboard navigation
  - Test tab key behavior for form fields
  - Test escape key for cancellation
  - Test arrow keys for item selection

- [ ] Add tests for template validation
  - Test required field validation
  - Test format string validation
  - Test error handling for invalid templates

- [ ] Add tests for template loading
  - Test loading from default templates directory
  - Test loading from user templates directory
  - Test error handling for template loading failures

## Definition of Done

- All tests for template components pass without TypeScript errors or warnings
- Test coverage for template components is comprehensive
- Template selection UI functions correctly with proper keyboard navigation
- Error handling is thoroughly tested

## Next Steps

After completing this step, we will have a robust testing infrastructure for template-related components. The next step will be to implement the Pattern Detection Engine (Phase 3.2.1), which will analyze commit messages for common patterns and provide warnings or suggestions.